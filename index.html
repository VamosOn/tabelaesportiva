<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
<title>Entradas Esportivas</title>

<style>
  :root {
    --cor-primaria: #007bff;
    --cor-sucesso: #22c55e;
    --cor-perigo: #ef4444;
    --cor-fundo: #f8fafc;
    --cor-texto: #1e293b;
    --radius: 8px;
  }

  body {
    font-family: "Inter", sans-serif;
    background: var(--cor-fundo);
    margin: 0;
    padding: 0;
    color: var(--cor-texto);
  }

  header {
    background: var(--cor-primaria);
    color: white;
    text-align: center;
    padding: 15px 0;
    font-weight: 600;
    font-size: 1.3rem;
  }

  main {
    width: 95%;
    max-width: 900px;
    margin: 20px auto;
  }

  .meta-card {
    background: white;
    border-radius: var(--radius);
    padding: 15px;
    margin-bottom: 20px;
  }

  .meta-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }

  .progress-bar {
    height: 14px;
    background: #e2e8f0;
    border-radius: var(--radius);
    overflow: hidden;
    margin-top: 10px;
  }

  .progress {
    height: 100%;
    background: var(--cor-sucesso);
    width: 0%;
    transition: width 0.4s ease;
  }

  /* Form layout */
  form {
    background: white;
    border-radius: var(--radius);
    padding: 15px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  label {
    font-size: 13px;
    font-weight: 600;
  }

  input[type="text"],
  input[type="date"],
  input[type="time"],
  input[type="number"],
  input[type="file"] {
    width: 100%;
    padding: 10px;
    border-radius: var(--radius);
    border: 1px solid #cbd5e1;
    font-size: 15px;
    box-sizing: border-box;
  }

  /* bot√£o principal do formul√°rio ocupa a linha inteira */
  button[type="submit"] {
    grid-column: 1 / -1;
    padding: 14px;
    border: none;
    border-radius: var(--radius);
    font-size: 16px;
    color: white;
    background: var(--cor-primaria);
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
    width: 100%;
  }

  button[type="submit"]:active {
    background: #0056d2;
  }

  /* Tabela */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: white;
    border-radius: var(--radius);
    overflow: hidden;
  }

  th {
    background: var(--cor-primaria);
    color: white;
    font-size: 13px;
    padding: 10px;
    text-align: center;
  }

  td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #f1f5f9;
    font-size: 14px;
  }

  /* bot√µes de a√ß√£o na tabela ‚Äî inline e compactos */
  .btn {
    display: inline-block;
    border: none;
    border-radius: 6px;
    padding: 6px 8px;
    font-size: 13px;
    margin: 2px 4px 2px 0;
    color: white;
    cursor: pointer;
    line-height: 1;
    vertical-align: middle;
  }

  .btn-ganhou { background: var(--cor-sucesso); }
  .btn-perdeu { background: #facc15; color: #000; }
  .btn-remove { background: var(--cor-perigo); }
  .btn-imagem { background: #0ea5e9; }

  .btn-reset {
    background: var(--cor-perigo);
    color: white;
    width: 100%;
    margin-top: 10px;
    font-weight: bold;
    padding: 10px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
  }

  @media (max-width: 600px) {
    form { grid-template-columns: 1fr; }
    th, td { font-size: 12px; }
    .btn { font-size: 12px; padding: 6px 6px; }
  }
</style>
</head>

<body>
  <header>‚öΩ Entradas Esportivas</header>

  <main>
    <div class="meta-card">
      <div class="meta-top">
        <h3>Meta:</h3>
        <span id="valorMeta">R$ 0,00</span>
      </div>
      <div class="progress-bar"><div id="barraProgresso" class="progress"></div></div>
      <div class="meta-restante" id="metaRestante">Faltam R$ 0,00</div>
      <div class="meta-restante" style="color:#1e40af;">Banca Atual: <strong id="bancaAtual">R$ 0,00</strong></div>
      <button class="btn-reset" id="resetarPainel">üîÑ Resetar Painel</button>
    </div>

    <form id="entradaForm">
      <div>
        <label for="jogo">Jogo</label>
        <input id="jogo" type="text" placeholder="Ex: Flamengo x Palmeiras" required>
      </div>
      <div>
        <label for="data">Data</label>
        <input id="data" type="date" required>
      </div>
      <div>
        <label for="hora">Hora</label>
        <input id="hora" type="time" required>
      </div>
      <div>
        <label for="odd">Odd</label>
        <input id="odd" type="number" step="0.01" placeholder="1.85" required>
      </div>
      <div>
        <label for="tipo">Tipo</label>
        <input id="tipo" type="text" placeholder="Ex: Over 2.5" required>
      </div>
      <div>
        <label for="entrada">Valor da Entrada</label>
        <input id="entrada" type="number" step="0.01" placeholder="Ex: 100" required>
      </div>
      <div>
        <label for="banca">Banca Inicial</label>
        <input id="banca" type="number" step="0.01" placeholder="Ex: 1000" required>
      </div>
      <div>
        <label for="meta">Meta</label>
        <input id="meta" type="number" step="0.01" placeholder="Ex: 500" required>
      </div>
      <!-- CAMPO DE IMAGEM -->
      <div>
        <label for="imagem">Imagem</label>
        <input id="imagem" type="file" accept="image/*">
      </div>

      <button type="submit">‚ûï Adicionar Entrada</button>
    </form>

    <table id="tabelaEntradas">
      <thead>
        <tr>
          <th>Jogo</th><th>Data</th><th>Hora</th><th>Odd</th>
          <th>Tipo</th><th>Entrada</th><th>Ganho</th><th>Imagem</th><th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
    // Elementos
    const form = document.getElementById("entradaForm");
    const tabela = document.querySelector("#tabelaEntradas tbody");
    const metaEl = document.getElementById("valorMeta");
    const metaRestanteEl = document.getElementById("metaRestante");
    const barra = document.getElementById("barraProgresso");
    const bancaEl = document.getElementById("bancaAtual");
    const resetBtn = document.getElementById("resetarPainel");
    const imagemInput = document.getElementById("imagem");

    // estado (ser√° carregado do localStorage)
    let entradas = [];
    let meta = 0, ganhoTotal = 0, banca = 0, inicializado = false;

    const STORAGE_KEY = "entradasEsportivas";

    // salva tudo: entradas + meta + banca + ganhoTotal + inicializado
    function salvarTudo() {
      const payload = { entradas, meta, ganhoTotal, banca, inicializado };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    }

    // carrega do storage (se houver) e define vari√°veis
    function carregarTudo() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      try {
        const obj = JSON.parse(raw);
        entradas = Array.isArray(obj.entradas) ? obj.entradas : [];
        meta = typeof obj.meta === "number" ? obj.meta : 0;
        banca = typeof obj.banca === "number" ? obj.banca : 0;
        ganhoTotal = typeof obj.ganhoTotal === "number" ? obj.ganhoTotal : 0;
        inicializado = !!obj.inicializado;
      } catch (err) {
        console.error("Erro ao carregar storage:", err);
      }
    }

    function atualizarPainel() {
      const restante = Math.max(meta - ganhoTotal, 0);
      const progresso = meta > 0 ? (ganhoTotal / meta) * 100 : 0;
      metaRestanteEl.textContent = `Faltam R$ ${restante.toFixed(2)}`;
      barra.style.width = `${Math.min(progresso, 100)}%`;
      metaEl.textContent = `R$ ${meta.toFixed(2)}`;
      bancaEl.textContent = `R$ ${banca.toFixed(2)}`;
    }

    function renderizar() {
      tabela.innerHTML = "";
      entradas.forEach((e, i) => {
        const linha = document.createElement("tr");
        linha.innerHTML = `
          <td>${e.jogo}</td><td>${e.data}</td><td>${e.hora}</td>
          <td>${parseFloat(e.odd).toFixed(2)}</td><td>${e.tipo}</td>
          <td>R$ ${parseFloat(e.entrada).toFixed(2)}</td>
          <td><strong style="color:green">R$ ${(parseFloat(e.entrada) * parseFloat(e.odd)).toFixed(2)}</strong></td>
          <td>${e.imagem ? `<button class='btn btn-imagem'>üñºÔ∏è Ver</button>` : "‚Äî"}</td>
          <td>
            <button class="btn btn-ganhou">‚úÖ</button>
            <button class="btn btn-perdeu">‚ùå</button>
            <button class="btn btn-remove">üóëÔ∏è</button>
          </td>
        `;

        // bot√£o Ver imagem (se existir)
        if (e.imagem) {
          const btnVer = linha.querySelector(".btn-imagem");
          btnVer.onclick = () => {
            const w = window.open();
            if (!w || w.closed || typeof w.closed == 'undefined') {
              // fallback simples: abrir usando link
              const link = document.createElement('a');
              link.href = e.imagem;
              link.target = '_blank';
              link.click();
            } else {
              w.document.write(`<title>Imagem</title>
                <style>body{margin:0;display:flex;align-items:center;justify-content:center;background:#111}img{max-width:100%;max-height:100vh;border-radius:8px;}</style>
                <img src="${e.imagem}" alt="imagem">`);
            }
          };
        }

        // marcar ganhou ‚Äî desativa somente os bot√µes de resultado/remover (imagem permanece funcional)
        linha.querySelector(".btn-ganhou").onclick = () => {
          if (e.status) return; // j√° marcado
          const ganho = (parseFloat(e.entrada) * parseFloat(e.odd)) - parseFloat(e.entrada);
          ganhoTotal += ganho;
          banca += ganho;
          e.status = "ganhou";
          atualizarPainel();
          // desativa apenas os bot√µes de resultado e remover
          const btns = linha.querySelectorAll(".btn-ganhou, .btn-perdeu, .btn-remove");
          btns.forEach(b => b.disabled = true);
          salvarTudo();
        };

        linha.querySelector(".btn-perdeu").onclick = () => {
          if (e.status) return; // j√° marcado
          banca -= parseFloat(e.entrada);
          e.status = "perdeu";
          atualizarPainel();
          const btns = linha.querySelectorAll(".btn-ganhou, .btn-perdeu, .btn-remove");
          btns.forEach(b => b.disabled = true);
          salvarTudo();
        };

        linha.querySelector(".btn-remove").onclick = () => {
          // se a entrada j√° tinha sido marcada, ajustar ganhoTotal/banca ao remover
          if (e.status === "ganhou") {
            const ganho = (parseFloat(e.entrada) * parseFloat(e.odd)) - parseFloat(e.entrada);
            ganhoTotal -= ganho;
            banca -= ganho;
          } else if (e.status === "perdeu") {
            banca += parseFloat(e.entrada);
          }
          entradas.splice(i, 1);
          salvarTudo();
          renderizar();
        };

        // estilizar linha se j√° tiver status
        if (e.status === "ganhou") {
          linha.style.background = "#dcfce7";
        } else if (e.status === "perdeu") {
          linha.style.background = "#fee2e2";
        }

        tabela.appendChild(linha);
      });

      atualizarPainel();
    }

    // --- formul√°rio ---
    form.addEventListener("submit", e => {
      e.preventDefault();
      const jogo = document.getElementById("jogo").value;
      const data = document.getElementById("data").value;
      const hora = document.getElementById("hora").value;
      const odd = parseFloat(document.getElementById("odd").value);
      const tipo = document.getElementById("tipo").value;
      const entradaValor = parseFloat(document.getElementById("entrada").value);
      const metaInput = document.getElementById("meta").valueAsNumber;
      const bancaInput = document.getElementById("banca").valueAsNumber;

      // se ainda n√£o inicializou, seta meta e banca e marca inicializado
      if (!inicializado) {
        meta = isFinite(metaInput) ? metaInput : 0;
        banca = isFinite(bancaInput) ? bancaInput : 0;
        inicializado = true;
      }

      const novo = {
        jogo,
        data,
        hora,
        odd,
        tipo,
        entrada: entradaValor,
        imagem: null,
        status: null
      };

      // ler imagem (se houver) como base64
      const file = imagemInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          novo.imagem = reader.result;
          entradas.push(novo);
          salvarTudo();
          renderizar();
          form.reset();
        };
        reader.readAsDataURL(file);
      } else {
        entradas.push(novo);
        salvarTudo();
        renderizar();
        form.reset();
      }

      atualizarPainel();
    });

    // reset geral
    resetBtn.onclick = () => {
      if (!confirm("Tem certeza que deseja resetar tudo?")) return;
      entradas = [];
      meta = 0;
      ganhoTotal = 0;
      banca = 0;
      inicializado = false;
      localStorage.removeItem(STORAGE_KEY);
      document.getElementById("meta").disabled = false;
      document.getElementById("banca").disabled = false;
      renderizar();
    };

    // carregar e iniciar
    carregarTudo();
    renderizar();
  </script>
</body>
</html>
